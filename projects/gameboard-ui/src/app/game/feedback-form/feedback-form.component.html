<div class="d-flex align-items-center" tabindex="0" (click)="toggle()">
  <fa-icon class="d-inline" [icon]="show ? faCaretDown : faCaretRight" size="lg"></fa-icon>
  <span>
    <h3 *ngIf="type == 'challenge'" class="d-inline">{{title}}</h3>
    <h2 *ngIf="type == 'game'" class="d-inline">{{title}}</h2>
  </span>
</div>

<form #form="ngForm" [ngFormOptions]="{updateOn: 'change'}" [hidden]="!show" class="pop-light p-4 mt-4">

  <app-error-div [errors]="errors"></app-error-div>
  
  <div *ngIf="game.feedbackTemplate.message as message" class="mb-3 bg-light p-2 rounded d-flex justify-content-left">
    <fa-icon [icon]="faExclamationCircle" class="pr-1"></fa-icon>
    <small><span class="font-weight-bold align-middle">{{message}}</span></small>
  </div>

  <div *ngFor="let q of feedbackForm.questions; let i = index" class="mb-4">
    <label for="{{q.id}}">
      {{i+1}}. {{q.prompt}}
      <span *ngIf="q.required" class="required">*</span>
    </label>
    <ng-container *ngIf="q.type == 'text'">
      <textarea rows="3" type="text" class="form-control" id={{q.id}} name={{q.id}}
      [(ngModel)]="q.answer" [disabled]="feedbackForm.submitted!" maxlength={{characterLimit}}></textarea>
      <small class="d-flex justify-content-end" [class]="q.answer?.length == characterLimit ? 'text-warning' : 'text-muted'">
        {{characterLimit - (q.answer?.length ?? 0)}}
      </small>
    </ng-container>
    <div *ngIf="q.type == 'likert'">
      <small class="pr-2 text-dark">{{q.minLabel}}</small>
      <div id={{q.id}} class="btn-group" btnRadioGroup name={{q.id}} tabindex="0" [(ngModel)]="q.answer"
        [disabled]="feedbackForm.submitted!">
        <label *ngFor="let i of options(q.min ?? 1, q.max ?? 1)" class="btn btn-outline-dark btn-sm m-0" btnRadio="{{i}}">{{i}}
        </label>
      </div>
      <small class="pl-2 text-dark">{{q.maxLabel}}</small>
    </div>
  </div>

  <app-confirm-button btnClass="btn btn-sm btn-secondary" (confirm)="submit()" [disabled]="feedbackForm.submitted! || !feedbackForm?.questions?.length">
    <fa-icon [icon]="faSubmit"></fa-icon>
    <span>{{feedbackForm.submitted ? "Submitted" : "Submit"}}</span>
  </app-confirm-button>
  <div class="mt-3 d-flex justify-content-between">
    <small class="">Responses cannot be changed after clicking submit.</small>
    <small class="">{{status}}</small>
  </div>
</form>

<p [hidden]="show || !feedbackForm.submitted" class="p-4 text-center">
  Thank you for submitting feedback!
</p>
